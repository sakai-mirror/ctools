<project name="buildInstance" basedir="." default="info-instance" >

  <!--

   $Id: build.xml 5796 2006-02-06 19:03:57Z dlhaines@umich.edu $
   $HeadURL: https://source.sakaiproject.org/svn/branches/ctools-winter-06/tools/build.xml $

   Customize sakai.properties for each instance.

  -->

  <!-- 
       TTD:
  -->


  <target name="info-instance" >
    <echo>
      create sakai.properties customized to specific instances.
    </echo>
  </target>

  <property name="type.file" value="instance.${type}.properties" />
  <property file="${type.file}" />

  <target name="buildProperties" depends="copyConfig, editInstanceSakaiProperties" 
	  description="copy and edit the sakai.properties files." />

  <target name="copyConfig">
    <copy todir="${instances.dir}/${type}">
      <fileset dir="${config.dir}">
	<exclude name="**/sakai.properties"/>
	<exclude name="**/.project" />
      </fileset>
    </copy>
  </target>


  <target name="editInstanceSakaiProperties" >
    <echo> sakai.properties: ${sakai.properties} </echo>
    <echo> type: ${type} </echo>
    <echo> instances.dir: ${instances.dir}</echo>
    <echo> serverUrl: ${serverUrl} </echo>
    <echo> version.service: ${version.service} </echo>
    <echo> version.sakai: ${version.sakai} </echo>

    <!-- to add a new property to be customized add a new token filter
    entry below -->

    <copy file="${sakai.properties}" 
	  tofile="${instances.dir}/${type}/sakai.properties" 
	  overwrite="true">

       <filterchain> 

	<tokenfilter>
	  <replaceregex pattern="^(serverUrl\s*=\s*).*" replace="\1${serverUrl}"/>
	</tokenfilter>

	<tokenfilter>
	  <replaceregex pattern="^(serverName\s*=\s*).*" replace="\1${serverName}"/>
	</tokenfilter>

	<tokenfilter>
	  <replaceregex pattern="^(loggedOutUrl\s*=\s*).*" replace="\1${loggedOutUrl}" />
	</tokenfilter>

	<tokenfilter>
	  <replaceregex pattern="^(bodyPath@org.sakaiproject.service.legacy.content.ContentHostingService\s*=\s*).*" replace="\1${bodyPath}"/>
	</tokenfilter>

	<tokenfilter>
	  <replaceregex pattern="^(version.service\s*=\s*).*" replace="\1${version.service}"/>
	</tokenfilter>

	<tokenfilter>
	  <replaceregex pattern="^(version.sakai\s*=\s*).*" replace="\1${version.sakai}"/>
	</tokenfilter>

	<tokenfilter>
	  <replaceregex pattern="^(bodyVolumes@org.sakaiproject.service.legacy.content.ContentHostingService\s*=\s*).*" replace="\1${bodyVolumes}"/>
	</tokenfilter>

	<tokenfilter>
	  <replaceregex pattern="^(storagePath\s*=\s*).*" replace="\1${storagePath}"/>
	</tokenfilter>

	<tokenfilter>
	  <replaceregex pattern="^(skin.default\s*=\s*).*" replace="\1${skin.default}"/>
	</tokenfilter>

	<tokenfilter>
	  <replaceregex pattern="^(login.icon\s*=\s*).*" replace="\1${login.icon}"/>
	</tokenfilter>

	<tokenfilter>
	  <replaceregex pattern="^(bottomnav.1\s*=\s*).*" replace="\1${bottomnav.1}"/>
	</tokenfilter>

	<tokenfilter>
	  <replaceregex pattern="^(resources.show_all_collections.tool\s*=\s*).*" replace="\1${resources.show_all_collections.tool}"/>
	</tokenfilter>

	<tokenfilter>
	  <replaceregex pattern="^(resources.show_all_collections.dropbox\s*=\s*).*" replace="\1${resources.show_all_collections.dropbox}"/>
	</tokenfilter>

	<tokenfilter>
	  <replaceregex pattern="^(resources.show_all_collections.helper\s*=\s*).*" replace="\1${resources.show_all_collections.helper}"/>
	</tokenfilter>

	<tokenfilter>
	  <replaceregex pattern="^(ui.service\s*=\s*).*" replace="\1${ui.service}"/>
	</tokenfilter>

	<tokenfilter>
	  <replaceregex pattern="^(wsetup.group.support\s*=\s*).*" replace="\1${wsetup.group.support}"/>
	</tokenfilter>

	<tokenfilter>
	  <replaceregex pattern="^(stealthTools@org.sakaiproject.api.kernel.tool.ActiveToolManager\s*=\s*).*" 
			replace="\1${stealthTools@org.sakaiproject.api.kernel.tool.ActiveToolManager}"/>
	</tokenfilter>

      </filterchain> 
    </copy>

  </target>

</project>
