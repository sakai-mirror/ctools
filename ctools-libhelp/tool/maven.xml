<?xml version="1.0" encoding="UTF-8"?>

<project 
	xmlns:j="jelly:core"
	xmlns:ant="jelly:ant"
	xmlns:maven="jelly:maven"
	xmlns:u="jelly:util">
	
	<preGoal name="war:war">
		<attainGoal name="ctools-iframe-libhelp" />
	</preGoal>

	<goal name="ctools-iframe-libhelp">

		<!-- ctools library help is based on sakai iframe tool -->
		<ant:echo>Note: depends on sakai-web-tool war</ant:echo>

		<!-- modify the content of the sakai-web-tool war to create ctools-iframe-libhelp webapp -->
		<ant:unwar src="${maven.repo.local}/sakaiproject/wars/sakai-web-tool-${pom.currentVersion}.war" 
			dest="${maven.build.dir}/ctools-iframe-libhelp" />
		
		<!-- add libhelp tool registration to a fresh tools dir -->
		<ant:delete dir="${maven.build.dir}/ctools-iframe-libhelp/tools" />
		<ant:mkdir dir="${maven.build.dir}/ctools-iframe-libhelp/tools" />
		<ant:copy file="${basedir}/src/webapp/tools/ctools.iframe.libhelp.xml"
				tofile="${maven.build.dir}/ctools-iframe-libhelp/tools/ctools.iframe.libhelp.xml"
				overwrite="true" />
	
		<!-- replace the web.xml file -->
		<ant:delete file="${maven.build.dir}/ctools-iframe-libhelp/WEB-INF/web.xml" />
		<ant:copy file="${basedir}/src/webapp/WEB-INF/web.xml"
				tofile="${maven.build.dir}/ctools-iframe-libhelp/WEB-INF/web.xml"
				overwrite="true" />
	
		<!-- war up the results -->
		<ant:war destfile="${maven.build.dir}/ctools-iframe-libhelp.war" 
			webxml="${maven.build.dir}/ctools-iframe-libhelp/WEB-INF/web.xml"
			basedir="${maven.build.dir}/ctools-iframe-libhelp" update="true" />
			
		<!-- war and pom are automatically copied to the local repo -->
	
	</goal>

</project>
