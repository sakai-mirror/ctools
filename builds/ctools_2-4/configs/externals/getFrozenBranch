#!/bin/bash # -*- sh -*-
# generate an externals file from an existing .externals file from SVN

# $HeadURL:$
# $Id:$
# take .externals file in svn, get the latest revision number for
# each entry in it and write it out in the svn externals format.

# TTD:
# - Does the .externals file already need to be checked in?
# - Don't use a tmp file in current directory.
# - 

URL=$1

if [ x$URL == x ]; then
    echo must specify a svn url to a directory with a .externals file
    exit 1;
fi

# Take existing externals and script to get updated information
svn cat $URL/.externals | perl -n -e 'm|(\S+).*(http.*)| && print "svn --limit 1 -q log $2\necho $1 -rREVISION $2\n"'  >| ./externals.tmp

# find the updated information and format as a .externals script
source ./externals.tmp | perl -n -e 'chomp; if (m/r(\d+)\s/) {$R=$1}; if (m/https/i) {s/REVISION/$R/; print " $_\n"}'

rm ./externals.tmp
#end
