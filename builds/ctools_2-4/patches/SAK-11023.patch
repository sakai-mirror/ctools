svn diff -r33517:33518 https://source.sakaiproject.org/svn
Index: site/site-impl/impl/src/java/org/sakaiproject/site/impl/SiteCacheImpl.java
===================================================================
--- site/site-impl/impl/src/java/org/sakaiproject/site/impl/SiteCacheImpl.java	(revision 33517)
+++ site/site-impl/impl/src/java/org/sakaiproject/site/impl/SiteCacheImpl.java	(revision 33518)
@@ -23,6 +23,7 @@
 
 import java.util.Iterator;
 import java.util.Map;
+import java.util.concurrent.ConcurrentHashMap;
 
 import org.sakaiproject.memory.api.Cache;
 import org.sakaiproject.memory.api.DerivedCache;
@@ -32,8 +33,6 @@
 import org.sakaiproject.site.api.SitePage;
 import org.sakaiproject.site.api.ToolConfiguration;
 
-import EDU.oswego.cs.dl.util.concurrent.ConcurrentReaderHashMap;
-
 /**
  * <p>
  * SiteCacheImpl is a cache tuned for Site (and page / tool) access.
@@ -42,13 +41,13 @@
 public class SiteCacheImpl implements DerivedCache
 {
 	/** Map of a tool id to a cached site's tool configuration instance. */
-	protected Map m_tools = new ConcurrentReaderHashMap();
+	protected Map m_tools = new ConcurrentHashMap();
 
 	/** Map of a page id to a cached site's SitePage instance. */
-	protected Map m_pages = new ConcurrentReaderHashMap();
+	protected Map m_pages = new ConcurrentHashMap();
 
 	/** Map of a group id to a cached site's Group instance. */
-	protected Map m_groups = new ConcurrentReaderHashMap();
+	protected Map m_groups = new ConcurrentHashMap();
 
 	/** The base cache. */
 	protected Cache m_cache = null;
Index: memory/memory-impl/impl/src/java/org/sakaiproject/memory/impl/MemCache.java
===================================================================
--- memory/memory-impl/impl/src/java/org/sakaiproject/memory/impl/MemCache.java	(revision 33517)
+++ memory/memory-impl/impl/src/java/org/sakaiproject/memory/impl/MemCache.java	(revision 33518)
@@ -30,6 +30,7 @@
 import java.util.Observer;
 import java.util.Set;
 import java.util.Vector;
+import java.util.concurrent.ConcurrentHashMap;
 
 import org.apache.commons.logging.Log;
 import org.apache.commons.logging.LogFactory;
@@ -40,8 +41,6 @@
 import org.sakaiproject.memory.api.CacheRefresher;
 import org.sakaiproject.memory.api.DerivedCache;
 
-import EDU.oswego.cs.dl.util.concurrent.ConcurrentReaderHashMap;
-
 /**
  * <p>
  * A Cache of objects with keys with a limited lifespan.
@@ -250,7 +249,7 @@
 		m_memoryService = memoryService;
 		m_eventTrackingService = eventTrackingService;
 
-		m_map = new ConcurrentReaderHashMap();
+		m_map = new ConcurrentHashMap();
 
 		// register as a cacher
 		m_memoryService.registerCacher(this);
Index: memory/memory-impl/impl/src/java/org/sakaiproject/memory/impl/MultiRefCacheImpl.java
===================================================================
--- memory/memory-impl/impl/src/java/org/sakaiproject/memory/impl/MultiRefCacheImpl.java	(revision 33517)
+++ memory/memory-impl/impl/src/java/org/sakaiproject/memory/impl/MultiRefCacheImpl.java	(revision 33518)
@@ -26,6 +26,7 @@
 import java.util.Map;
 import java.util.Observable;
 import java.util.Vector;
+import java.util.concurrent.ConcurrentHashMap;
 
 import org.apache.commons.logging.Log;
 import org.apache.commons.logging.LogFactory;
@@ -34,8 +35,6 @@
 import org.sakaiproject.event.api.EventTrackingService;
 import org.sakaiproject.memory.api.MultiRefCache;
 
-import EDU.oswego.cs.dl.util.concurrent.ConcurrentReaderHashMap;
-
 /**
  * <p>
  * MultiRefCacheImpl implements the MultiRefCache.
@@ -97,7 +96,7 @@
 	{
 		super(memoryService, eventTrackingService, sleep, "");
 		m_softRefs = false;
-		m_refs = new ConcurrentReaderHashMap();
+		m_refs = new ConcurrentHashMap();
 	}
 
 	/**
Index: tool/tool-impl/impl/src/java/org/sakaiproject/tool/impl/ToolComponent.java
===================================================================
--- tool/tool-impl/impl/src/java/org/sakaiproject/tool/impl/ToolComponent.java	(revision 33517)
+++ tool/tool-impl/impl/src/java/org/sakaiproject/tool/impl/ToolComponent.java	(revision 33518)
@@ -31,6 +31,7 @@
 import java.util.Properties;
 import java.util.Set;
 import java.util.Vector;
+import java.util.concurrent.ConcurrentHashMap;
 
 import org.apache.commons.logging.Log;
 import org.apache.commons.logging.LogFactory;
@@ -45,8 +46,6 @@
 import org.w3c.dom.Node;
 import org.w3c.dom.NodeList;
 
-import EDU.oswego.cs.dl.util.concurrent.ConcurrentReaderHashMap;
-
 /**
  * <p>
  * ToolComponent is the standard implementation of the Sakai Tool API.
@@ -64,7 +63,7 @@
 	protected final static String CURRENT_TOOL = "sakai:ToolComponent:current.tool";
 
 	/** The registered tools. */
-	protected Map m_tools = new ConcurrentReaderHashMap();
+	protected Map m_tools = new ConcurrentHashMap();
 
 	/** tool ids to be hidden - their catagories don't matter, they don't show up on any catagorized listing. */
 	protected String[] m_toolIdsToHide = null;
Index: tool/tool-impl/impl/src/java/org/sakaiproject/tool/impl/SessionComponent.java
===================================================================
--- tool/tool-impl/impl/src/java/org/sakaiproject/tool/impl/SessionComponent.java	(revision 33517)
+++ tool/tool-impl/impl/src/java/org/sakaiproject/tool/impl/SessionComponent.java	(revision 33518)
@@ -28,6 +28,7 @@
 import java.util.Iterator;
 import java.util.Map;
 import java.util.Set;
+import java.util.concurrent.ConcurrentHashMap;
 
 import javax.servlet.ServletContext;
 import javax.servlet.http.HttpSession;
@@ -48,8 +49,6 @@
 import org.sakaiproject.tool.api.ToolSession;
 import org.sakaiproject.util.IteratorEnumeration;
 
-import EDU.oswego.cs.dl.util.concurrent.ConcurrentReaderHashMap;
-
 /**
  * <p>
  * Standard implementation of the Sakai SessionManager.
@@ -61,7 +60,7 @@
 	private static Log M_log = LogFactory.getLog(SessionComponent.class);
 
 	/** The sessions - keyed by session id. */
-	protected Map m_sessions = new ConcurrentReaderHashMap();
+	protected Map m_sessions = new ConcurrentHashMap();
 
 	/** The maintenance. */
 	protected Maintenance m_maintenance = null;
@@ -311,13 +310,13 @@
 	public class MySession implements Session, HttpSession
 	{
 		/** Hold attributes in a Map. TODO: ConcurrentHashMap may be better for multiple writers */
-		protected Map m_attributes = new ConcurrentReaderHashMap();
+		protected Map m_attributes = new ConcurrentHashMap();
 
 		/** Hold toolSessions in a Map, by placement id. TODO: ConcurrentHashMap may be better for multiple writers */
-		protected Map m_toolSessions = new ConcurrentReaderHashMap();
+		protected Map m_toolSessions = new ConcurrentHashMap();
 
 		/** Hold context toolSessions in a Map, by context (webapp) id. TODO: ConcurrentHashMap may be better for multiple writers */
-		protected Map m_contextSessions = new ConcurrentReaderHashMap();
+		protected Map m_contextSessions = new ConcurrentHashMap();
 
 		/** The creation time of the session. */
 		protected long m_created = 0;
@@ -862,7 +861,7 @@
 	public class MyLittleSession implements ToolSession, ContextSession, HttpSession
 	{
 		/** Hold attributes in a Map. TODO: ConcurrentHashMap may be better for multiple writers */
-		protected Map m_attributes = new ConcurrentReaderHashMap();
+		protected Map m_attributes = new ConcurrentHashMap();
 
 		/** The creation time of the session. */
 		protected long m_created = 0;
