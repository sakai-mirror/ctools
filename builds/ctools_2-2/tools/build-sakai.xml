<project name="build-sakai" basedir="." default="info" >


<!--
# $Id$
# $HeadURL$
-->

<target name="sakaiBuildInfo" >
  <echo>
    This installs and compiles the sakai code.  Targets in this file should not be invoked directly
    but should be called by the master build.xml.

    The default values for the sakai build are given below.  They are usually overridden by a properties file.

    sakai.svndir = ${sakai.svndir}
    sakai.svnurl = ${sakai.svnurl}
    sakai.revision = ${sakai.revision}
  </echo>
</target>


  <!-- ================================================== -->
  <!--             construct the source                   -->
  <!-- ================================================== -->

  <!-- ================================================== -->
  <!--               deal with Sakai proper               -->
  <!-- ================================================== -->

  <target name="getSakaiSrc" depends="prepareBuildDirs">
    <execSvnCmd url="${sakai.svnurl}" revision="${sakai.revision}"/>
    <!--
    <place fromdir="${build.dir}/${sakai.svndir}" />
    -->
    <antcall target="removeUnneededSakai" />
  </target>

  <target name="getConfigurationSrc"
	  description="update the configuration information (not the executable files)." >
    <echo> update configuration from ${build.configuration.svnurl}/${build.configuration.configdir} revision: ${build.configuration.revision}</echo>
<!--    <echo>  fromdir="${build.dir}/${sakai.svndir}" </echo> -->
<!-- force is added since this will checkout over existing files -->
    <execSvnCmd url="${build.configuration.svnurl}/${build.configuration.configdir}" revision="${build.configuration.revision}"
		additionalArguments="--force" />
    <!--
    <place fromdir="${build.dir}/${build.configuration.configdir}" 
	   todir="${build.dir}/${build.configuration.configdir}"
	   verbose="yes" />
    -->
  </target>

  <target name="removeUnneededSakai" >
    <removeFromBuild deleteDir="portal/mercury" />
    <removeFromBuild deleteDir="common/common-composite-component/src/test" />
    <removeFromBuild deleteDir="edu/coursemanagement-tool/src/test" />
    <removeFromBuild deleteDir="gradebook/testservice" />
    <removeFromBuild deleteDir="metaobj/api-impl/src/test" />
    <removeFromBuild deleteDir="osid/osid-unit-test" />
    <removeFromBuild deleteDir="rwiki/jrcs/src/completetest" />
    <removeFromBuild deleteDir="rwiki/jrcs/src/test" />
    <removeFromBuild deleteDir="rwiki/radeox/src/test" />
    <removeFromBuild deleteDir="rwiki/rwiki/src/test" />
    <removeFromBuild deleteDir="rwiki/rwiki/src/testBundle" />
    <removeFromBuild deleteDir="sam/testdata" />
    <removeFromBuild deleteDir="sam/tests" />
    <removeFromBuild deleteDir="sam/tool/src/java/test" />
    <removeFromBuild deleteDir="providers" />
    <removeFromBuild deleteDir="wsrp" />
    <removeFromBuild deleteDir="warehouse" />
    <removeFromBuild deleteDir="reports/api-impl" />
    <removeFromBuild deleteDir="reports/components" />
    <removeFromBuild deleteDir="reports/tool" />

    <!-- remove for this build.  Find a better way. 
    <removeFromBuild deleteDir="sam" />
    -->

    <!-- removed as of 4/28/06 -->
    <!--
    <removeFromBuild deleteDir="roster" />
    -->
    <removeFromBuild deleteDir="webservices" />


  </target>

  <target name="editSakai" >
  </target>

  <target name="removeSamigo" if="remove.samigo">
    <removeWarFromImage deleteWar="sakai-samigo.war" />
  </target>

  <target name="imageSakai"  if="favicon.name" >
    <copy file="${reference.dir}/${favicon.name}"
	  tofile="${image.dir}/webapps/ROOT"
	  overwrite="true" />
    <!--
    <removeWarFromImage deleteWar="sakai-wsrp-producer.war" />
    -->
    <removeWarFromImage deleteWar="sakai-comp-test-app1.war" />
    <removeWarFromImage deleteWar="sakai-group-test.war" />
    <removeWarFromImage deleteWar="sakai-osid-repo-test.war" />
    <removeWarFromImage deleteWar="sakai-sections-testservice.war" />
    <removeWarFromImage deleteWar="sakai-jsf-example.war" />
    <removeWarFromImage deleteWar="sakai-sample-tools-browser.war" />
    <removeWarFromImage deleteWar="sakai-sample-tools-jsf1.war" />
    <removeWarFromImage deleteWar="sakai-sample-tools-qa-helper.war" />
    <removeWarFromImage deleteWar="sakai-wsrp-producer.war" />

  </target>

  <target name="compileSakai" depends="editMaster">
    <exec executable="maven"
	  dir="${build.dir}"
	  failonerror="true"
	  searchpath="true"
	  >
	  <env key="MAVEN_OPTS" value="-Djava.net.preferIPv4Stack=true -Xmx512m" />

      <arg value="-b" />
      <!--  sometimes needed with a new build 
      <arg value="-o" />
       -->
      <arg value="sakai:clean" />
      <arg value="sakai:build" />
      <arg value="sakai:deploy-zip" />
      <arg value="pack-src" />
    </exec>
  </target>


</project>
